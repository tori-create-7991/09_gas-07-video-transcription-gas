services:
  # ローカルファイル変換（従来の方法）
  converter:
    build: .
    volumes:
      - ./input:/input
      - ./output:/output

  # OAuth認証セットアップ（初回のみ実行）
  oauth-setup:
    build:
      context: .
      dockerfile: Dockerfile.drive
    volumes:
      - ./credentials:/app/credentials
    entrypoint: ["python", "oauth_setup.py"]
    stdin_open: true
    tty: true

  # Google Drive連携変換
  drive-converter:
    build:
      context: .
      dockerfile: Dockerfile.drive
    volumes:
      # 認証ファイル（トークン更新のため読み書き可能）
      - ./credentials:/app/credentials
    environment:
      # 動画があるDriveフォルダID
      - INPUT_FOLDER_ID=${INPUT_FOLDER_ID}
      # M4Aを保存するDriveフォルダID
      - OUTPUT_FOLDER_ID=${OUTPUT_FOLDER_ID}
      # 既存ファイルをスキップするか
      - SKIP_EXISTING=true
